var comment_page = 0;


function loadComments(reset=false){
    let xhr = new XMLHttpRequest();
    let game_id = document.getElementById("game-id").value;
    if (reset){
        comment_page = 0;
    }
    console.log(comment_page);
    console.log(reset);
    let e = document.getElementById("comment-order");
    let order = e.options[e.selectedIndex].value;
    xhr.open("GET", `/comments/${game_id}/${comment_page}/${order}/`);
    xhr.timeout = 1000;
    xhr.onload = function(reponse){
        let comment_container = document.getElementById("comment-section");
        console.log(xhr.status);
        if (reset) {
            comment_container.innerHTML = xhr.responseText;
        } else {
            comment_container.innerHTML += xhr.responseText;
        }
        if (xhr.status == 304){
            let button_cont = document.getElementById("load-more-comments");
            button_cont.style.display = "none";
        } else {
            comment_page += 1;
            let button_cont = document.getElementById("load-more-comments");
            button_cont.style.display = "flex";
        }
    }
    xhr.send();
}


$(function() {
    $("#comment-form").submit(function(event) {
        event.preventDefault();
        var commentForm = $(this);
        var posting = $.post( commentForm.attr('action'), commentForm.serialize() );
        posting.done(function(data) {
            document.getElementById("comment-box").value = "";
            loadComments(true);
        });
        posting.fail(function(data) {
            // 4xx or 5xx response, alert user about failure
        });
    });
});

